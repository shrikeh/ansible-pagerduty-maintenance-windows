---
- hosts: local
  gather_facts: no
  tasks:
    - add_host:
        groups: test
        name: "{{ lookup('env','TEST_ANSIBLE_HOSTNAME') }}"
        ansible_connection: "{{ lookup('env','TEST_ANSIBLE_CONNECTION') }}"
        ansible_ssh_port: "{{ test_host_ssh_port | default('22') }}"

- hosts: test
  gather_facts: no
  vars:
    pagerduty_maintenance_window_subdomain: 'inviqa'
    pagerduty_maintenance_window_token: "{{ lookup('env', 'PAGERDUTY_MAINTENANCE_WINDOW_TOKEN') }}"
    pagerduty_maintenance_windows:
      - token: "{{ lookup('env', 'PAGERDUTY_MAINTENANCE_WINDOW_TOKEN') }}"
        description: 'Nightly MySQL backup'
        service_ids:
          -  "{{ lookup('env', 'PAGERDUTY_MAINTENANCE_WINDOW_SERVICE_ID') }}"
        dates:
          - start:  '2015-12-03T03:00:00Z'
            end:    '2015-12-03T03:15:00Z'
          - start:  '2015-12-04T03:00:00Z'
            end:    '2015-12-04T03:15:00Z'
          - start:  '2015-12-05T03:00:00Z'
            end:    '2015-12-05T03:15:00Z'
          - start:  '2015-12-06T03:00:00Z'
            end:    '2015-12-06T03:15:00Z'
          - start:  '2015-12-07T03:00:00Z'
            end:    '2015-12-07T03:15:00Z'
          - start:  '2015-12-08T03:00:00Z'
            end:    '2015-12-08T03:15:00Z'
          - start:  '2015-12-09T03:00:00Z'
            end:    '2015-12-09T03:15:00Z'
          - start:  '2015-12-10T03:00:00Z'
            end:    '2015-12-10T03:15:00Z'
          - start:  '2015-12-11T03:00:00Z'
            end:    '2015-12-11T03:15:00Z'
          - start:  '2015-12-12T03:00:00Z'
            end:    '2015-12-12T03:15:00Z'
  roles:
    - { role: '../../' }
